
// CXWView.h : CCXWView 类的接口
//

#pragma once
//-------y一使用dcmtklog方式
#include "dcmtk/config/osconfig.h"    /* make sure OS specific configuration is included first */
#include "dcmtk/oflog/fileap.h"
#include "dcmtk/oflog/oflog.h"

//--------------------
#include<vector>
class CCXWView : public CView
{
protected: // 仅从序列化创建
	CCXWView();
	DECLARE_DYNCREATE(CCXWView)

// 特性
public:
	CCXWDoc* GetDocument() const;

// 操作
public:

// 重写
public:
	virtual void OnDraw(CDC* pDC);  // 重写以绘制该视图
	virtual BOOL PreCreateWindow(CREATESTRUCT& cs);
public:
    double  g_min_x, g_max_x,  g_min_y, g_max_y, g_distance;
    std::vector<double> g_Xvalue, g_Yvalue, g_X_get, g_Y_get;//输入点坐标和计算后交点坐标
    std::vector<double> g_display_Xvalue, g_display_Yvalue, g_display_X_get, g_display_Y_get;//坐标等比例调整后的坐标点
    int g_row;
public:
    bool GetIntersection(double xo, double yo, int index_point, double &x_get, double &y_get, bool thesameline = false);
    void ReadExcelFie(CString pathfilename, CString filename);
    void ConvertedPoint();
protected:
	virtual BOOL OnPreparePrinting(CPrintInfo* pInfo);
	virtual void OnBeginPrinting(CDC* pDC, CPrintInfo* pInfo);
	virtual void OnEndPrinting(CDC* pDC, CPrintInfo* pInfo);

// 实现
public:
	virtual ~CCXWView();
#ifdef _DEBUG
	virtual void AssertValid() const;
	virtual void Dump(CDumpContext& dc) const;
#endif

protected:

// 生成的消息映射函数
protected:
	afx_msg void OnFilePrintPreview();
	afx_msg void OnRButtonUp(UINT nFlags, CPoint point);
	afx_msg void OnContextMenu(CWnd* pWnd, CPoint point);
	DECLARE_MESSAGE_MAP()
public:
    afx_msg void OnFileOpen();
};

#ifndef _DEBUG  // CXWView.cpp 中的调试版本
inline CCXWDoc* CCXWView::GetDocument() const
   { return reinterpret_cast<CCXWDoc*>(m_pDocument); }
#endif
/*
线段和圆交点
1.线段和圆交点公式是通过直线方程联合到圆心距离方程求解得出。
2.目前没有考虑圆同时和2条线段交点。
公式：
（线段点集合：[ (x1 , y1) .....(xn-1 , yn-1), (xn , yn) ]）
线段方程（例如：线段(xn-1 , yn-1), (xn , yn)）：
Y=KX+B ( K= ，B  =  ，X（x1, xn）, Y(y1,yn))  ①
(x-xo)2 +(y-yo)2=R2  [ (xo,yo) 为圆心坐标 ，R 为半径即直线和圆交点距离]   ②

联合方程求解：
X= ,其中 (b2-4ac)是否大于等于0决定有解否（向量不考虑）。
a = 1+k2 , b =2k(B-yo)-2xo , c=xo2+(B-yo)2-R2


X	Y
768993.066	8986418.913
769157.124	8986593.659
769259.255	8986723.796
769259.453	8986794.327
769255.567	8987087.868
769260.525	8987219.499
769246.107	8987311.280
769284.832	8987668.625
769281.995	8987727.123
769295.275	8987808.473
769260.701	8987928.291
769255.027	8988010.235
769227.490	8988081.546


X	Y
768993.066	8986418.913
769157.124	8986593.659
举例计算：
（769157.124-768993.066）2 + （8986593.659-8986418.913）2
= 164.0582 +174.7462
= 26915.027364 + 30536.164516 = 57451.19188

= 239.68978259408555773783955063908
两点距离 ： 239.68978259408555773783955063908

假设圆心 即第一个点，距离为 R=200
K =
=
=  174.746/164.058
= 1.0651476916700191395725901815212
B  =
=
=(6911968126182.286212-6910628210730.568494)/164.058
=1339915451.717718/164.058
=8167327.7238398493215813919467505

{a = 1+k2 , b =2k(B-yo)-2xo , c=xo2+(B-yo)2-R2}
K2 = 1.0651476916700191395725901815212 2 = 1.1345396050699701603320279648667
a =  1+k2
= 2.1345396050699701603320279648667

b = 2.1302953833400382791451803630424*(8167327.7238398493215813919467505-8986418.913)
=2.1302953833400382791451803630424* (-819091.1891601506784186080532495)-2*(768993.066)
=-1744906.1788023709962444755254013-1537986.132
=-3282892.3108023709962444755254013
b2 = 10777381924325.331247319854380261
C  =768993.0662+(-819091.1891601506784186080532495)2-(200)2
=591350335556.080356+670910376159.78974023575685992016-40000
=1262260671715.8700962357568599202
4ac = 4*2.1345396050699701603320279648667*1262260671715.8700962357568599202
= 10777381582798.994436124628727136
b2-4ac = 10777381924325.331247319854380261 - 10777381582798.994436124628727136
= 341526.33681119522565312488238621
= 341526.336811195225653125
= 584.40254688972328746623690422823

X=
= （3282892.3108023709962444755254013  584.40254688972328746623690422823）/2*2.1345396050699701603320279648667
{
X1=3283476.7133492607195319417623055/4.2690792101399403206640559297334
=769129.95794276406189827981863364
X2=3282307.9082554812729570092884971/4.2690792101399403206640559297334
=768856.17405723593810172018136641 不在线段内
}
X	Y
768993.066	8986418.913
769157.124	8986593.659
Y= kx + B
= 1.0651476916700191395725901815212*769129.95794276406189827981863364+8167327.7238398493215813919467505
=8986564.7231368433649104390227051

求交点XY（769129.95794276406189827981863364，8986564.7231368433649104390227051）


验证距离
D2 = （769129.95794276406189827981863364-768993.066）2+（8986564.7231368433649104390227051-8986418.913）2
= 136.891942764061898279818633642 +145.81013684336491043902270512
=18739.403993719198711252248736492+21260.596006280801288747812835259
=40000.000000000000000000061571751
D=200.00000000000000000000015392938
*/

